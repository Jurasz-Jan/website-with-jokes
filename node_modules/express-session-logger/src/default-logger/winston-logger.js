const winston = require('winston');
const transports = require('./winston-transports');

const isOffline = process.env.IS_OFFLINE || process.env.IS_LOCAL;
const prettifyLogs = isOffline || process.env.LOG_CLI_MODE;

// create logger instance
const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  exitOnError: false,
  handleExceptions: true,
  format: winston.format.combine(
    winston.format.json(),
    winston.format.timestamp(),
  ),
  exceptionHandlers: transports.jsonConsole,
});

if (prettifyLogs) {
  logger.add(transports.cliConsole);
} else {
  logger.add(transports.jsonConsole);
}

module.exports = logger;
